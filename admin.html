<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin — Gelukkig en Gezond</title>
    <link rel="stylesheet" href="landing.css" />
  </head>
  <body class="industrial">
    <header class="site-header">
      <div class="wrap">
        <h1 class="brand"><a href="index.html">Gelukkig en Gezond — Admin</a></h1>
        <nav class="top-nav">
          <a href="index.html">Home</a>
          <a href="dashboard.html">Dashboard</a>
        </nav>
      </div>
    </header>

    <main class="wrap">
      <section class="card centered">
        <h1>Adminpaneel</h1>
        <p class="muted">Toegankelijk voor beheerders. Hier kun je beheeracties uitvoeren.</p>
        <div id="admin-content">
          <p class="muted">Bezig met controleren van toegangsrechten…</p>
        </div>

        <section class="card admin-dashboard" style="margin-top:1rem">
          <nav class="admin-nav">
            <a href="#">Gebruikers</a>
            <a href="#">Afspraken</a>
            <a href="#">Producten</a>
            <a href="#">Systeem</a>
          </nav>

          <div>
            <h2>Overzicht & statistieken</h2>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:0.75rem">
              <div class="card" id="stats-card">
                <h3>Samenvatting</h3>
                <ul id="stats-list" class="muted"></ul>
              </div>
              <div class="card">
                <h3>Afspraken (laatste)</h3>
                <canvas id="appts-chart" width="400" height="200"></canvas>
              </div>
            </div>
            <div style="margin-top:1rem">
              <h3>Gebruikers</h3>
              <div id="users-list" class="muted"></div>
            </div>
          </div>
        </section>
      </section>
    </main>

    <footer class="site-footer">
      <div class="wrap"><p class="muted">© 2025 Gelukkig en Gezond.</p></div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="auth.js"></script>
    <script>
      async function loadAdmin() {
        const u = await api('/api/me');
        if (!u || u.error || u.role !== 'admin') {
          document.getElementById('admin-content').innerHTML = '<p class="muted">Toegang geweigerd. Alleen beheerders mogen deze pagina zien.</p>';
          return;
        }
        document.getElementById('admin-content').innerHTML = '<p>Welkom, ' + (u.name || '') + '. Hieronder een klein overzicht met recente cijfers.</p>';

        // fetch basic stats
        const users = await api('/api/users') || [];
        const appts = await api('/api/appointments') || [];
        const inv = await api('/api/inventory') || [];
        const statsList = document.getElementById('stats-list');
        statsList.innerHTML = `<li>Gebruikers: <strong>${users.length}</strong></li><li>Afspraken: <strong>${appts.length}</strong></li><li>Producten: <strong>${inv.length}</strong></li>`;

        // users list
        const usersList = document.getElementById('users-list');
        usersList.innerHTML = users.map(u=>`<div>${u.name} — <span class="muted">${u.email} • ${u.role}</span></div>`).join('');

        // simple chart: appointments per dag (last 7)
        const byDay = {};
        const now = Date.now();
        appts.forEach(a => {
          const d = new Date(a.datetime);
          const key = d.toISOString().slice(0,10);
          byDay[key] = (byDay[key] || 0) + 1;
        });
        const labels = Object.keys(byDay).slice(-7);
        const data = labels.map(l => byDay[l] || 0);
        const ctx = document.getElementById('appts-chart');
        new Chart(ctx, { type: 'bar', data: { labels, datasets:[{label:'Afspraken', data, backgroundColor:'#60a5fa'}] }, options:{responsive:true} });
      }

      // small endpoint to return users (file-based)
      // (not ideal for production, but OK for a dev demo)
      api('/api/me').then(()=>{}).catch(()=>{});
      loadAdmin();

    </script>
  </body>
</html>